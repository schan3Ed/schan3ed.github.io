function getDataUrlFromFile(t){return new Promise(function(e,n){var r=new FileReader;r.readAsDataURL(t),r.onload=function(){e(r.result)},r.onerror=n})}function getFilefromDataUrl(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Date.now();return new Promise(function(r){for(var i=t.split(","),a=i[0].match(/:(.*?);/)[1],o=atob(i[1]),h=o.length,l=new Uint8Array(h);h--;)l[h]=o.charCodeAt(h);var u=void 0;try{u=new File([l],e,{type:a})}catch(t){(u=new Blob([l],{type:a})).name=e,u.lastModified=n}r(u)})}function loadImage(t){return new Promise(function(e,n){var r=new Image;r.onload=function(){e(r)},r.onerror=n,r.src=t})}function drawImageInCanvas(t,e){var n=document.createElement("canvas"),r=n.getContext("2d");return Number.isInteger(e)&&(t.width>e||t.height>e)?t.width>t.height?(n.width=e,n.height=t.height/t.width*e):(n.width=t.width/t.height*e,n.height=e):(n.width=t.width,n.height=t.height),r.drawImage(t,0,0,n.width,n.height),n}function imageCompression(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Number.POSITIVE_INFINITY,n=arguments[2];return new Promise(function(r,i){var a,o,h,l,u,d=void 0,c=void 0,s=void 0;return t instanceof Blob||t instanceof File?/^image/.test(t.type)?(d=5,a=1024*e*1024,getDataUrlFromFile(t).then(function(e){try{return o=e,loadImage(o).then(function(e){try{return h=e,l=drawImageInCanvas(h,n),c=.9,getFilefromDataUrl(l.toDataURL(t.type,c),t.name,t.lastModified).then(function(e){try{var n=function(){return r(s)};if(s=e,"image/png"===t.type){var o,g=function e(){if(d--&&s.size>a){var n=void 0;return l.width*=.9,l.height*=.9,(u=l.getContext("2d")).drawImage(h,0,0,l.width,l.height),n=l.toDataURL(t.type,c),getFilefromDataUrl(n,t.name,t.lastModified).then(function(t){try{return s=t,e}catch(t){return i(t)}}.bind(this),i)}return[1]},f=function(){return n.call(this)};return(o=function(t){for(;t;){if(t.then)return void t.then(o,i);try{if(t.pop){if(t.length)return t.pop()?f.call(this):t;t=g}else t=t.call(this)}catch(t){return i(t)}}}.bind(this))(g)}var m,v=function e(){if(d--&&s.size>a){var n=void 0;return c*=.9,n=l.toDataURL(t.type,c),getFilefromDataUrl(n,t.name,t.lastModified).then(function(t){try{return s=t,e}catch(t){return i(t)}}.bind(this),i)}return[1]},w=function(){return n.call(this)};return(m=function(t){for(;t;){if(t.then)return void t.then(m,i);try{if(t.pop){if(t.length)return t.pop()?w.call(this):t;t=v}else t=t.call(this)}catch(t){return i(t)}}}.bind(this))(v)}catch(t){return i(t)}}.bind(this),i)}catch(t){return i(t)}}.bind(this),i)}catch(t){return i(t)}}.bind(this),i)):i(new Error("The file given is not an image")):i(new Error("The file given is not an instance of Blob or File"))}.bind(this))}imageCompression.drawImageInCanvas=drawImageInCanvas,imageCompression.getDataUrlFromFile=getDataUrlFromFile,imageCompression.getFilefromDataUrl=getFilefromDataUrl,imageCompression.loadImage=loadImage;export default imageCompression;
//# sourceMappingURL=browser-image-compression.mjs.map
